<!-- SINGLE TEMPLATE: IG Metall Methodenkarte ‚Äì Edit + Delete + Print + Auto-Hide (Feldstand 2025-10) -->

<div class="ig-wrap">

  <!-- Toolbar: erscheint nur, wenn ##edit##/##delete## vom System geliefert werden -->
  <div class="ig-toolbar no-print">
    <span id="ig-edit-slot">##edit##</span>
    <span id="ig-delete-slot">##delete##</span>
    <button class="ig-btn" onclick="window.print()">üñ®Ô∏è Als PDF drucken</button>
  </div>

  <article class="ig-card">

    <header>
      <h1 class="ig-title">[[Titel]]</h1>

      <!-- Ziel/Intention (Mehrfachauswahl) -->
      <p class="ig-sub" data-hide-if-empty>
        <span class="js-value"><strong>[[Ziel/Intention]]</strong></span>
      </p>

      <!-- Meta-Chips -->
      <div class="ig-meta">
        <span class="ig-chip js-chip">‚è±Ô∏è <strong>Zeit:</strong> <span class="js-value">[[Zeitbedarf]]</span></span>
        <span class="ig-chip js-chip">üë• <strong>Gr√∂√üe:</strong> <span class="js-value">[[Gruppengr√∂√üe]]</span></span>
        <span class="ig-chip js-chip">üß† <strong>Komplexit√§t:</strong> <span class="js-value">[[Komplexit√§tsgrad]]</span></span>
        <span class="ig-chip js-chip">üß∞ <strong>Vorbereitung:</strong> <span class="js-value">[[Vorbereitung n√∂tig]]</span></span>
        <span class="ig-chip js-chip">ü§ù <strong>Sozialform:</strong> <span class="js-value">[[Sozialform]]</span></span>
      </div>
    </header>

    <!-- Kurzbeschreibung (Pflicht) -->
    <section class="ig-section" data-hide-if-empty>
      <h3>Kurzbeschreibung</h3>
      <div class="ig-body js-value">[[Kurzbeschreibung]]</div>
    </section>

    <!-- Ablauf (Pflicht) -->
    <section class="ig-section" data-hide-if-empty>
      <h3>Ablauf</h3>
      <div class="ig-body js-value">[[Ablauf]]</div>
    </section>

    <!-- Lernziele -->
    <section class="ig-section" data-hide-if-empty>
      <h3>Lernziele (Ich-kann ‚Ä¶)</h3>
      <div class="ig-body js-value">[[Lernziele (Ich-kann ...)]]</div>
    </section>

    <!-- Reflexion -->
    <section class="ig-section" data-hide-if-empty>
      <h3>Reflexion</h3>
      <div class="ig-body js-value">[[Debrief/Reflexionsfragen]]</div>
    </section>

    <!-- Risiken & Tipps -->
    <section class="ig-section" data-hide-if-empty>
      <h3>Risiken & Tipps</h3>
      <div class="ig-body js-value">[[Risiken/Tipps]]</div>
    </section>

    <!-- Rahmen & Zug√§nglichkeit -->
    <section class="ig-section" id="rahmen">
      <h3>Rahmen & Zug√§nglichkeit</h3>
      <dl class="ig-kv">
        <div class="kv-row" data-hide-if-empty><dt>Raumanforderungen</dt><dd class="js-value">[[Raumanforderungen]]</dd></div>
        <div class="kv-row" data-hide-if-empty><dt>Barrierefreiheit / inklusiv</dt><dd class="js-value">[[Barrierefreiheit/inklusive Hinweise]]</dd></div>
        <div class="kv-row" data-hide-if-empty><dt>Fach-/Themenbezug</dt><dd class="js-value">[[Fach-/Themenbezug]]</dd></div>
      </dl>
    </section>

    <!-- Materialien -->
    <section class="ig-section" data-hide-if-empty>
      <h3>Materialien</h3>
      <div class="ig-body js-value">[[Materialien]]</div>
    </section>

    <!-- H5P (als Embed m√∂glich) -->
    <section class="ig-section" data-hide-if-empty>
      <h3>H5P-Inhalt</h3>
      <div class="ig-body js-value">[[H5P-Inhalt]]</div>
    </section>

    <!-- Material/Technik (Liste) -->
    <section class="ig-section" data-hide-if-empty>
      <h3>Material/Technik</h3>
      <div class="ig-body js-value">[[Material/Technik]]</div>
    </section>

    <!-- Kontakt -->
    <footer class="ig-section" data-hide-if-empty>
      <h3>Autor*in / Kontakt</h3>
      <div class="ig-body js-value">[[Autor*in / Kontakt]]</div>
    </footer>

    <!-- zuk√ºnftige Felder -->
    <section class="ig-section" data-hide-if-empty>
      <div class="ig-body js-value">##otherfields##</div>
    </section>

  </article>
</div>

<script>
(function(){
  // Hilfen: "leer" erkennen, aber Embeds/Medien als Inhalt werten (wichtig f√ºr H5P)
  function cleanedText(el){
    return String(el.innerHTML||'')
      .replace(/<!--[\s\S]*?-->/g,'')
      .replace(/<style[\s\S]*?<\/style>/gi,'')
      .replace(/<script[\s\S]*?<\/script>/gi,'')
      .replace(/&nbsp;|\u00A0/gi,' ')
      .replace(/<br\s*\/?>/gi,'')
      .replace(/<[^>]+>/g,'')
      .trim();
  }
  function hasMedia(el){
    return !!el.querySelector('iframe,embed,object,video,audio,img');
  }
  function isBlank(el){
    return !hasMedia(el) && cleanedText(el).length === 0;
  }

  // Meta-Chips: leere ausblenden, ggf. ganze Meta-Zeile verstecken
  document.querySelectorAll('.ig-chip.js-chip').forEach(chip=>{
    const v = chip.querySelector('.js-value');
    if(!v || isBlank(v)) chip.style.display = 'none';
  });
  const meta = document.querySelector('.ig-meta');
  if(meta && !meta.querySelector('.ig-chip.js-chip:not([style*="display: none"])')) meta.style.display = 'none';

  // Abschnitte mit data-hide-if-empty ausblenden
  document.querySelectorAll('[data-hide-if-empty]').forEach(el=>{
    const v = el.querySelector('.js-value') || el;
    if(isBlank(v)) el.style.display = 'none';
  });

  // "Rahmen & Zug√§nglichkeit" komplett verstecken, wenn alle Zeilen leer
  const rahmen = document.getElementById('rahmen');
  if(rahmen){
    const rows = rahmen.querySelectorAll('.kv-row');
    const visible = Array.from(rows).some(r => {
      const val = r.querySelector('.js-value') || r;
      return r.style.display !== 'none' && !isBlank(val);
    });
    if(!visible) rahmen.style.display = 'none';
  }

  // Bearbeiten-Link h√ºbsch machen (nur wenn vorhanden)
  const editSlot = document.getElementById('ig-edit-slot');
  if(editSlot){
    const a = editSlot.querySelector('a');
    if(a){
      editSlot.querySelectorAll('img').forEach(img => img.remove());
      a.classList.add('ig-btn','ig-btn--primary');
      a.textContent = '‚úèÔ∏è Bearbeiten';
    }else{
      editSlot.style.display = 'none';
    }
  }

  // L√∂schen-Link in roten Button verwandeln + Best√§tigung (nur wenn vorhanden)
  const delSlot = document.getElementById('ig-delete-slot');
  if(delSlot){
    const a = delSlot.querySelector('a');
    if(a){
      delSlot.querySelectorAll('img').forEach(img => img.remove());
      a.classList.add('ig-btn','ig-btn--danger');
      a.setAttribute('role','button');
      a.textContent = 'üóëÔ∏è L√∂schen';

      const titleText = (document.querySelector('.ig-title')?.textContent || 'diesen Eintrag').trim();
      a.addEventListener('click', (e)=>{
        const ok = confirm(`Eintrag ‚Äû${titleText}‚Äú wirklich l√∂schen?\nDieser Vorgang kann nicht r√ºckg√§ngig gemacht werden.`);
        if(!ok){ e.preventDefault(); }
      });
    }else{
      delSlot.style.display = 'none';
    }
  }
})();
</script>
